
document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const noticeId = urlParams.get("notice_id");

    if (!noticeId) {
        alert("ìž˜ëª»ëœ ì ‘ê·¼ìž…ë‹ˆë‹¤.");
        window.location.href = "http://192.168.1.100:80/notices/notices.html";
        return;
    }

    console.log("âœ… í˜„ìž¬ notice_id ê°’:", noticeId);

    const editBtnContainer = document.getElementById("editButtonContainer");
    const deleteBtnContainer = document.getElementById("deleteButtonContainer");

    fetch("http://192.168.1.101:5000/api/member/status", {
        method: "GET",
        credentials: "include"
    })
    .then(response => response.json())
    .then(data => {
        console.log("ðŸ” ì‚¬ìš©ìž ì •ë³´:", data);

        if (data.is_authenticated && (data.is_admin === true || data.is_admin === "true" || data.is_admin === 1)) {
            console.log("âœ… ê´€ë¦¬ìž ê³„ì • í™•ì¸ë¨. ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í™œì„±í™”");
            if (editBtnContainer) editBtnContainer.style.display = "block";
            if (deleteBtnContainer) deleteBtnContainer.style.display = "block";
        }
    })
    .catch(error => console.error("ðŸš¨ ì‚¬ìš©ìž ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));

    fetch(`http://192.168.1.101:5000/api/notices/detail/${noticeId}`)
    .then(response => {
        if (!response.ok) {
            console.error(`âŒ ê³µì§€ì‚¬í•­ API ì˜¤ë¥˜ (${response.status}):`, response.statusText);
            return response.text();
        }
        return response.json();
    })
    .then(data => {
        if (typeof data === "string" && data.includes("<!DOCTYPE html>")) {
            console.error("âŒ API ì‘ë‹µì´ JSONì´ ì•„ë‹˜:", data);
            alert("ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (404 Not Found)");
            return;
        }

        console.log("ðŸ“œ API ì‘ë‹µ ë°ì´í„°:", data);

        const noticeTitle = document.getElementById("noticeTitle");
        const noticeCreatedAt = document.getElementById("noticeCreatedAt");
        const noticeContent = document.getElementById("noticeContent");

        if (noticeTitle) noticeTitle.innerText = data.title || "ì œëª© ì—†ìŒ";
        if (noticeCreatedAt) noticeCreatedAt.innerText = data.created_at || "ë‚ ì§œ ì—†ìŒ";
        if (noticeContent) noticeContent.innerHTML = data.content || "ë‚´ìš© ì—†ìŒ";
    })
    .catch(error => console.error("ðŸš¨ ê³µì§€ì‚¬í•­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));
});


// âœ… ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í•¨ìˆ˜
function goBack() {
    window.location.href = "/notices";
}

// âœ… ìˆ˜ì • íŽ˜ì´ì§€ë¡œ ì´ë™
function goedit() {
    const noticeId = document.getElementById("editBtn").getAttribute("data-notice-id");
    if (!noticeId) {
        alert("ê³µì§€ì‚¬í•­ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    window.location.href = `/notices/edit/${noticeId}`;
}

// âœ… ê³µì§€ì‚¬í•­ ì‚­ì œ ê¸°ëŠ¥
document.addEventListener("DOMContentLoaded", function() {
    const deleteBtn = document.getElementById("deleteBtn");

    if (deleteBtn) {
        deleteBtn.addEventListener("click", function() {
            const noticeId = deleteBtn.getAttribute("data-notice-id");

            if (!noticeId) {
                alert("ê³µì§€ì‚¬í•­ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                fetch(`http://192.168.1.101:5000/api/notices/delete/${noticeId}`, {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                .then(response => {
                    if (!response.ok) throw new Error("ê³µì§€ì‚¬í•­ ì‚­ì œ ì‹¤íŒ¨");
                    return response.json();
                })
                .then(data => {
                    alert(data.message || "ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    window.location.href = "/notices";
                })
                .catch(error => {
                    console.error("ðŸš¨ ì‚­ì œ ì˜¤ë¥˜:", error);
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                });
            }
        });
    }
});
//dddd
document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const noticeId = urlParams.get("notice_id");

            if (!noticeId) {
                alert("ìž˜ëª»ëœ ì ‘ê·¼ìž…ë‹ˆë‹¤.");
                window.location.href = "http://192.168.1.100:80/notices/notices.html";
                return;
            }

            fetch(`http://192.168.1.101:5000/api/notices/detail/${noticeId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        window.location.href = "http://192.168.1.100:80/notices/notices.html";
                        return;
                    }

                    document.getElementById("notice_detail_title").textContent = data.title;
                    document.getElementById("notice_detail_date").textContent = data.created_at;
                    document.getElementById("notice_detail_content").textContent = data.content;

                    if (data.file_url) {
                        const fileLink = document.createElement("a");
                        fileLink.href = data.file_url;
                        fileLink.download = "";
                        fileLink.innerHTML = '<img src="http://192.168.1.100:80/static/images/file.png" width="20" height="15">';
                        document.getElementById("notice_file").appendChild(fileLink);
                    }
                })
                .catch(error => {
                    console.error("ê³µì§€ì‚¬í•­ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    alert("ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });


            // âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ìž ì •ë³´ í™•ì¸ (ê´€ë¦¬ìž ì—¬ë¶€)
fetch("http://192.168.1.101:5000/api/member/status")
                .then(response => response.json())
                .then(data => {
                    if (data.is_authenticated && data.is_admin) {
                        document.getElementById("admin_buttons").style.display = "block";
                    }
                })
                .catch(error => console.error("ê´€ë¦¬ìž ì—¬ë¶€ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));
        });
//
	    document.addEventListener("DOMContentLoaded", function () {
            const pathParts = window.location.pathname.split('/');
            const noticeId = pathParts[pathParts.length -1];
            const apiUrl = `http://192.168.1.101:5000/api/notices/detail/${noticeId}`;

            if (!noticeId) {
                alert("ê³µì§€ì‚¬í•­ IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert("ê³µì§€ì‚¬í•­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                        window.location.href = "http://192.168.1.100:80/notices/notices.html";
                        return;
                    }

                    document.getElementById("notice_detail_title").textContent = data.title;
                    document.getElementById("notice_detail_date").textContent = data.created_at;
                    document.getElementById("notice_detail_content").textContent = data.content;

                    if (data.file_url) {
                        const downloadLink = document.getElementById("download_link");
                        downloadLink.href = data.file_url;
                        downloadLink.style.display = "inline";
                    }

                    // ê´€ë¦¬ìž ê³„ì • ì—¬ë¶€ í™•ì¸ (ì„¸ì…˜ ìƒíƒœ ì²´í¬)
                    fetch("http://192.168.1.101:5000/api/member/status")
                        .then(response => response.json())
                        .then(userData => {
                            if (userData.is_authenticated && userData.is_admin) {
                                document.getElementById("editButtonContainer").style.display = "block";
                                document.getElementById("deleteButtonContainer").style.display = "block";
                                document.getElementById("editBtn").setAttribute("data-notice-id", noticeId);
                                document.getElementById("deleteBtn").setAttribute("data-notice-id", noticeId);
                            }
                        })
                        .catch(error => console.error("ì„¸ì…˜ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error));
                })
                .catch(error => console.error("ê³µì§€ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error));
        });

        function goBack() {
            window.location.href = "http://192.168.1.100:80/notices/notices.html";
        }
